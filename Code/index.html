<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="https://kurorosuke.github.io/homepoti/favicon.ico" />
    <link rel="stylesheet" href="main.css" />
    <title>褒めポチ</title>

    <!-- 1) Firebase compat を必ず先に -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <!-- 3) その後に connectDB を通常スクリプトとして -->
    <script src="connectDB.js"></script>
</head>
<body>
    <!-- ★ 追加: コインHUD（ログイン時に表示） -->
    <div id="coinHUD" aria-label="coin HUD" style="display:none;">
      🪙 <span id="coinBalance">0</span>
    </div>

    <!-- 効果音（任意） -->
    <audio id="ordersSound" preload="auto">
      <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAA" type="audio/mpeg">
    </audio>

    <!-- ログインしてなかったら表示 -->
    <div style="text-align: center;" id="notSigned">
        <h3>ログインしてください</h3>
        <button onclick="loginWithGoogle()">Googleでログイン</button>
    </div>

    <!-- ログインしてたら表示: 3タブ -->
    <div id="viewScreen" style="display:none;overflow-y:scroll;height:calc(100vh - 70px)">
        <button id="loadMoreBtn" style="display:none;">さらに読み込む</button>
    </div>

    <div id="postScreen" style="display:none;">
        <div class="InputForm">
        <textarea id="postTextInput" placeholder="今日はなにした？" maxlength="280"></textarea>
        <div id="charCount">0</div>
        <input type="file" id="fileInput" accept="image/*" onchange="viewImageCanvas()">
        <canvas id="canvas" style="display:none;"></canvas>
        <button onclick="post()">投稿</button>
        </div>
    </div>

    <!-- ★ 新規: 自分のサービス管理 -->
    <div id="servicesScreen" style="display:none;">
      <div class="InputForm">
        <h3>サービスを登録</h3>
        <input id="svcTitle" class="svc-input" type="text" placeholder="タイトル" maxlength="40">
        <textarea id="svcDesc" class="svc-input" placeholder="説明" maxlength="200"></textarea>
        <input id="svcPrice" class="svc-input" type="number" min="0" step="1" placeholder="価格（コイン）">
        <label class="svc-inline"><input id="svcActive" type="checkbox" checked> 公開</label>
        <button id="svcAddBtn">追加 / 更新</button>
      </div>

      <div class="InputForm">
        <h3>自分のサービス</h3>
        <div id="myServicesList" class="svc-list"></div>
      </div>

      <div class="InputForm">
        <h3>受けた注文 <span id="ordersBadge" class="badge" style="display:none;">0</span></h3>
        <div id="myOrdersList" class="order-list"></div>
      </div>
    </div>

    <!-- ★ 新規: マーケット -->
    <div id="marketScreen" style="display:none;">
      <div class="InputForm">
        <h3>マーケット</h3>
        <div id="marketList" class="svc-list"></div>
      </div>
    </div>

    <div id="bottomNav" style="display: none;">
        <div class="navigater">
          <button class="nav_buttons" onclick="switchTab('view')" aria-label="ViewScreen">投稿</button>
        </div>
        <div class="divider"></div>
        <div class="navigater">
          <button class="nav_buttons" onclick="switchTab('post')" aria-label="PostScreen">投稿する</button>
        </div>
        <div class="divider"></div>
        <div class="navigater">
          <button class="nav_buttons" onclick="switchTab('services')" aria-label="ServicesScreen">サービス</button>
        </div>
        <div class="divider"></div>
        <div class="navigater">
          <button class="nav_buttons" onclick="switchTab('market')" aria-label="MarketScreen">マーケット</button>
        </div>
    </div>

    <script>
        function switchTab(tab) {
          document.getElementById("viewScreen").style.display      = (tab === "view") ? "block" : "none";
          document.getElementById("postScreen").style.display      = (tab === "post") ? "block" : "none";
          document.getElementById("servicesScreen").style.display  = (tab === "services") ? "block" : "none";
          document.getElementById("marketScreen").style.display    = (tab === "market") ? "block" : "none";
        }
    </script>
    <script src="main.js"></script>
</body>
</html>
